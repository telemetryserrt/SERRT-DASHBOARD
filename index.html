<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="globals.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="BB-dashboard">
    <div class="div">
      <div class="overlap">
        <div class="overlap-group">
          <div class="overlap-2">
            <div class="ailiz">Ailiz &lt;3</div>
            <div class="top-bar">
              <div class="overlap-group-2">
                <div class="hour">
                  <div class="text-wrapper">7:30</div>
                </div>
                <div class="date">
                  <div class="text-wrapper-2">09/27/2023</div>
                </div>
              </div>
            </div>
            <div class="dashboard-indicators">
              <img class="low-beam-headlights" src="img/low-beam-headlights.svg" style="display: none;" />
              <div class="lights" style="display: none;">
                <div class="overlap-group-3">
                  <img class="shape" src="img/shape-1.svg" />
                  <div class="text-wrapper-3">AUTO</div>
                </div>
              </div>
              <img class="parking-lights" src="img/shape.svg" style="display: none;" />
              <!-- <img class="low-beam-headlights-2" src="img/low-beam-headlights.svg" /> -->
            </div>
          </div>
          <div class="MPH">
            <div class="overlap-3">
              <div class="text-wrapper-4" id="velocity">0.00</div>
              <div class="text-wrapper-5">MPH</div>
              <div class="o-v-bar"><img class="range-bar" src="img/range-bar.svg" /></div>
            </div>
          </div>
          <div class="right-side-analytics">
            <div class="average-mpkW">
              <div class="overlap-group-4">
                <div class="element-mpge">100 mpkW</div>
                <div class="text-wrapper-6">Avg. mpkW</div>
              </div>
              <img class="sun" src="img/sun.svg" />
            </div>
            <div class="optimal-velocity">
              <div class="overlap-group-4">
                <div class="element-optvel"> <em>34</em> mph</div>
                <div class="text-wrapper-6">Optimal Velociy</div>
              </div>
              <img class="speedometer" src="img/speedometer-svgrepo-com.svg" />
            </div>
            <div class="range">
              <div class="text-wrapper-7">188 mi</div>
              <div class="text-wrapper-8">Range</div>
              <div class="road-icon">
                <img class="rectangle" src="img/rectangle-97.svg" />
                <img class="rectangle-2" src="img/rectangle-98.svg" />
                <div class="rectangle-3"></div>
                <div class="rectangle-4"></div>
                <div class="rectangle-5"></div>
              </div>
            </div>
          </div>
          <!-- <img class="arrows" src="img/arrows.png" /> -->
          <img class="left-arrow" src="img/left-arrow.svg" />
          <img class="right-arrow" src="img/right-arrow.svg" />
        </div>
        <img class="road" src="img/road.png" />
        <div class="overlap-4">
          <div class="bottom-left">
            <div class="temperature">
              <p class="element-f"><span class="span">98 </span> <span class="text-wrapper-9">Â°F</span></p>
            </div>
            <div class="o-v">
              <div class="text-wrapper-10"><em>34</em> mph</div>
            </div>
          </div>
          <div class="battery-charge">
            <div class="overlap-5">
              <div class="text-wrapper-11">Battery charge</div>
              <img class="battery-ring" src="img/battery-ring.svg" />
              <div class="text-wrapper-12"><em>97</em>%</div>
            </div>
            <div class="charge">
              <div class="rectangle-6"></div>
              <div class="rectangle-7"></div>
              <div class="rectangle-8"></div>
              <div class="rectangle-9"></div>
              <div class="rectangle-10"></div>
              <div class="rectangle-11"></div>
              <div class="rectangle-12"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="gear-selection">
        <div class="ready">READY</div>
        <div class="text-wrapper-13" data-gear="R">R</div>
        <div class="text-wrapper-14" data-gear="N">N</div>
        <div class="text-wrapper-15" data-gear="D">D</div>
      </div>
    </div>
  </div>
  <script>
    // Create a variable to store the main gear
    let mainGear = "D";

    // Function to switch properties between gears
    function switchProperties(gear) {
      // Get the main and selected gear elements
      const mainElement = document.querySelector(`[data-gear="${mainGear}"]`);
      const selectedElement = document.querySelector(`[data-gear="${gear}"]`);

      // Store the styles of the main gear
      const mainStyles = {
        position: getComputedStyle(mainElement).getPropertyValue("position"),
        fontSize: getComputedStyle(mainElement).getPropertyValue("font-size"),
        opacity: getComputedStyle(mainElement).getPropertyValue("opacity"),
        left: getComputedStyle(mainElement).getPropertyValue("left"),
        top: getComputedStyle(mainElement).getPropertyValue("top"),
      };

      // Store the styles of the selected gear
      const selectedStyles = {
        position: getComputedStyle(selectedElement).getPropertyValue("position"),
        fontSize: getComputedStyle(selectedElement).getPropertyValue("font-size"),
        opacity: getComputedStyle(selectedElement).getPropertyValue("opacity"),
        left: getComputedStyle(selectedElement).getPropertyValue("left"),
        top: getComputedStyle(selectedElement).getPropertyValue("top"),
      };

      // Apply the styles of the selected gear to the main gear
      mainElement.style.position = selectedStyles.position;
      mainElement.style.fontSize = selectedStyles.fontSize;
      mainElement.style.opacity = selectedStyles.opacity;
      mainElement.style.left = selectedStyles.left;
      mainElement.style.top = selectedStyles.top;

      // Apply the styles of the main gear to the selected gear
      selectedElement.style.position = mainStyles.position;
      selectedElement.style.fontSize = mainStyles.fontSize;
      selectedElement.style.opacity = mainStyles.opacity;
      selectedElement.style.left = mainStyles.left;
      selectedElement.style.top = mainStyles.top;

      // Update the main gear variable
      mainGear = gear;
    }

    // Keyboard event listener to toggle gears
    document.addEventListener("keydown", (event) => {
      const key = event.key.toUpperCase();
      if (key === "R" || key === "N" || key === "D") {
        switchProperties(key);
      }
    });

    // Track the state of arrow key toggles
    let leftArrowToggled = false;
    let rightArrowToggled = false;
    let isBlinking = false;
    let blinkInterval;

    // Function to start or stop arrow blinking based on the state
    function toggleArrowBlinking(className, toggleState) {
      const arrowElement = document.querySelector(className);
      if (toggleState) {
        arrowElement.classList.add("blinking");
      } else {
        arrowElement.classList.remove("blinking");
      }
    }

    // Keyboard event listener to toggle arrow blinking
    document.addEventListener("keydown", (event) => {
      if (event.key === "ArrowLeft") {
        if (!leftArrowToggled) {
          // Start blinking for left arrow
          toggleArrowBlinking(".left-arrow", true);
          toggleArrowBlinking(".right-arrow", false); // Stop blinking for right arrow
          leftArrowToggled = true;
          rightArrowToggled = false;
        } else {
          // Toggle blinking for left arrow
          toggleArrowBlinking(".left-arrow", false);
          leftArrowToggled = false;
        }
      } else if (event.key === "ArrowRight") {
        if (!rightArrowToggled) {
          // Start blinking for right arrow
          toggleArrowBlinking(".right-arrow", true);
          toggleArrowBlinking(".left-arrow", false); // Stop blinking for left arrow
          rightArrowToggled = true;
          leftArrowToggled = false;
        } else {
          // Toggle blinking for right arrow
          toggleArrowBlinking(".right-arrow", false);
          rightArrowToggled = false;
        }
      } else {
        // If any other key is pressed, stop blinking for both arrows
        if (leftArrowToggled || rightArrowToggled) {
          toggleArrowBlinking(".left-arrow", false);
          toggleArrowBlinking(".right-arrow", false);
          leftArrowToggled = false;
          rightArrowToggled = false;
        }
      }
    });

    // Keyboard event listener to toggle lights
    document.addEventListener("keydown", (event) => {
      if (event.key === "C") {
        // Toggle low beam headlights
        const lowBeamHeadlights = document.querySelectorAll(".low-beam-headlights");
        lowBeamHeadlights.forEach((headlight) => {
          headlight.style.display = headlight.style.display === "none" ? "block" : "none";
        });
      } else if (event.key === "I") {
        // Toggle parking lights
        const parkingLights = document.querySelectorAll(".parking-lights");
        parkingLights.forEach((parkingLight) => {
          parkingLight.style.display = parkingLight.style.display === "none" ? "block" : "none";
        });

        // Toggle both arrows
        const leftArrow = document.querySelector(".left-arrow");
        const rightArrow = document.querySelector(".right-arrow");

        if (!isBlinking) {
          isBlinking = true;

          blinkInterval = setInterval(() => {
            toggleArrowBlinking(".left-arrow", true);
            toggleArrowBlinking(".right-arrow", true);
          });
        } else {
          isBlinking = false;
          clearInterval(blinkInterval); // Stop the blinking interval
          toggleArrowBlinking(".left-arrow", false);
          toggleArrowBlinking(".right-arrow", false);
        }
      } else if (event.key === "A") {
        // Toggle lights
        const lights = document.querySelectorAll(".lights");
        lights.forEach((light) => {
          light.style.display = light.style.display === "none" ? "block" : "none";
        });
      }
    });

    // // Function to update velocity (text-wrapper-4) gradually
    // function updateVelocity() {
    //   var currentVelocity = parseFloat(document.querySelector(".text-wrapper-4").textContent);
    //   var targetVelocity = Math.floor(Math.random() * 100); // Generate a random target velocity
    //   var step = 1; // Adjust the step size for the transition speed

    //   // Gradually transition to the target velocity
    //   if (targetVelocity > currentVelocity) {
    //     currentVelocity = Math.min(currentVelocity + step, targetVelocity);
    //   } else if (targetVelocity < currentVelocity) {
    //     currentVelocity = Math.max(currentVelocity - step, targetVelocity);
    //   }

    //   // Update the HTML element with the current velocity
    //   document.querySelector(".text-wrapper-4").textContent = currentVelocity;
    // }

    // function updateVelocity() {
    //   const { exec } = require('child_process');
    //   // Run the Python script
    //   exec('python motor_velocity.py', (error, stdout, stderr) => {
    //     if (stdout) {
    //       // Update the HTML element with the current velocity
    //       document.querySelector(".text-wrapper-4").textContent = stdout;
    //     }
    //     if (stderr) {
    //       console.error(`stderr: ${stderr}`);
    //     }
    //     if (error) {
    //       console.error(`Error: ${error}`);
    //     }
    //   });
    // };

    const mphValue = document.getElementById('velocity'); // Use 'velocity' as the ID
    const socket = new WebSocket("ws://136.145.230.109:5678");

    socket.onmessage = function (event) {
        mphValue.textContent = event.data;
    };

    // Function to update battery charge (text-wrapper-12) gradually
    function updateBatteryCharge() {
      var currentCharge = parseInt(document.querySelector(".text-wrapper-12").textContent);
      var step = 1; // Adjust the step size for the transition speed

      // Gradually decrease the battery charge (simulate discharging)
      if (currentCharge > 0) {
        currentCharge = Math.max(currentCharge - step, 0);
      }

      // Update the HTML element with the current battery charge
      document.querySelector(".text-wrapper-12").querySelector("em").textContent = currentCharge;
    }

    function updateDate() {
      var date = new Date();
      var hour = date.getHours();
      var minute = date.getMinutes();
      var day = date.getDate();
      var month = date.getMonth() + 1;
      var year = date.getFullYear();

      document.querySelector(".text-wrapper").textContent = hour + ":" + minute;
      document.querySelector(".text-wrapper-2").textContent = month + "/" + day + "/" + year;
    };

    function updateBatteryColor() {
      var battery_ring = document.querySelector(".battery-ring");
      var currentCharge = parseInt(document.querySelector(".text-wrapper-12").querySelector("em").textContent);

      if (currentCharge >= 90) {
        battery_ring.src = 'img/battery-ring.svg';
      } else if (currentCharge >= 80 && currentCharge < 90) {
        battery_ring.src = 'img/battery-ring-y.svg';
      } else {
        battery_ring.src = 'img/battery-ring-r.svg';
      }
    };

    function updateRangeColor() {
      var range_bar = document.querySelector(".range-bar");
      var currentVelocity = document.querySelector(".text-wrapper-4");
      var currentVelocityNumber = parseFloat(document.querySelector(".text-wrapper-4").textContent);
      var currentOptimalVelocity = parseFloat(document.querySelector(".element-optvel").querySelector("em").textContent);

      if (currentVelocityNumber > currentOptimalVelocity + 5 || currentVelocityNumber < currentOptimalVelocity - 5) {
        range_bar.src = 'img/range-bar-r.svg'
        currentVelocity.style.color = '#ea0000';
      } else if (currentVelocityNumber > currentOptimalVelocity + 3 || currentVelocityNumber < currentOptimalVelocity - 3) {
        range_bar.src = 'img/range-bar-y.svg';
        currentVelocity.style.color = '#ead700';
      } else {
        range_bar.src = 'img/range-bar.svg';
        currentVelocity.style.color = '#01EB7B';
      }
    };

    function updateOptimalVelocity() {
      var currentOptimalVelocity = parseFloat(document.querySelector(".element-optvel").querySelector("em").textContent);
      var targetOptimalVelocity = Math.floor(Math.random() * 100); // Generate a random target velocity
      var step = 1; // Adjust the step size for the transition speed

      // Gradually transition to the target velocity
      if (targetOptimalVelocity > currentOptimalVelocity) {
        currentOptimalVelocity = Math.min(currentOptimalVelocity + step, targetOptimalVelocity);
      } else if (targetOptimalVelocity < currentOptimalVelocity) {
        currentOptimalVelocity = Math.max(currentOptimalVelocity - step, targetOptimalVelocity);
      }

      // Update the HTML element with the current velocity
      document.querySelector(".element-optvel").querySelector('em').textContent = currentOptimalVelocity;
      document.querySelector(".text-wrapper-10").querySelector('em').textContent = currentOptimalVelocity;
    };


    // Call the updateValues function initially
    updateVelocity();
    updateBatteryCharge();
    updateBatteryColor();
    updateOptimalVelocity();
    updateRangeColor();
    updateDate();

    // Set intervals to update values gradually every second
    setInterval(updateDate, 1000);
    setInterval(updateVelocity, 1500); // Change every second for velocity
    setInterval(updateRangeColor, 1000);
    setInterval(updateBatteryCharge, 2000); // Change every 4 seconds for battery charge
    setInterval(updateBatteryColor, 10000); // Change every 4 seconds for battery charge
    setInterval(updateOptimalVelocity, 4000); // Change every 4 seconds for optimal velocity
  </script>
</body>

</html>
